import React from 'react';
import { useDispatch } from 'react-redux';

function VulnerabilityChange({ row, isDisableClick }) {
  const { prevDetails, vulnerability } = row;
  const dispatch = useDispatch();

  let status = 'new';

  if (prevDetails && prevDetails.rating && prevDetails.likelihood) {
    const oldVulnerability = (prevDetails.rating * prevDetails.likelihood);
    if (oldVulnerability === vulnerability) {
      status = 'stagnant';
    } else if (vulnerability > oldVulnerability) {
      status = 'up';
    } else {
      status = 'down';
    }
  }
  if (status === 'up') {
    return (
      <div
        className="vcStatus vcStatus-up"
        onClick={handleClick}
        role="presentation"
      >
        <span className="rafi-icon-arrow-up" />
      </div>
    );
  }
  if (status === 'stagnant') {
    return (
      <div
        className="vcStatus vcStatus-stagnant"
        onClick={handleClick}
        role="presentation"
      >
        <span className="rafi-icon-arrow-sides" />
      </div>
    );
  }
  if (status === 'new') {
    return (
      <div
        className="vcStatus vcStatus-new"
        onClick={handleClick}
        role="presentation"
      >
        <span className="text">
          new
        </span>
      </div>
    );
  }
  return (
    <div
      className="vcStatus vcStatus-down"
      onClick={handleClick}
      role="presentation"
    >
      <span className="rafi-icon-arrow-down" />
    </div>
  );

  function handleClick() {
    if (isDisableClick) {
      return;
    }
    dispatch({
      type: 'SHOW_DIALOG',
      payload: {
        path: 'RiskChanges',
        props: {
          title: 'Vulnerability Changes',
          dialogId: 'RiskChanges',
          risk: row,
          dialogClassName: 'i_dialog_container--lg',
        },
      },
    });
  }
}

export default VulnerabilityChange;
